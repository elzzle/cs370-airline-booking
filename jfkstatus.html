<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="styles.css">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-storage.js"></script>
        <script src="backend/fb.js"></script>

        <title>JFK Flights Status</title>
        <nav class="navbar navbar-light" style="background-color: #14277e;">
            <a class="navbar-brand" href="index.html">
                <img class="logo" src="images/logo.svg" alt="AirBook SVG" width="80" height="80" onerror="this.removeAttribute('onerror'); this.src='images/logo.svg'" />
            </a>
            <div class="logsign-container">
                <a id="loginBtn" class="btn btn-danger" href="login.html">Login</a>
                <a id="signupBtn" class="btn btn-danger" href="signup.html">Sign Up</a>
                <button id="logoutBtn" class="btn btn-danger" onclick="logOutUser()">Log out</button>
            </div>
        </nav>
        
    </head>

    <body style="background-color: white">
        <script>
            //logs user out
            function logOutUser(){
                firebase.auth().signOut();
                window.location.href="index.html"
            }
            //checks if user is logged in and diplays the buttons on the nav accordingly
            firebase.auth().onAuthStateChanged(function(user){
                if(user){
                    document.getElementById('loginBtn').style.display='none';
                    document.getElementById('signupBtn').style.display='none';
                    document.getElementById('logoutBtn').style.display='block';
                }
                else {
                    document.getElementById('loginBtn').style.display='inline';
                    document.getElementById('signupBtn').style.display='inline';
                    document.getElementById('logoutBtn').style.display='none';
                }
            });

            // Get current date

            var date = new Date();
            var mm = date.getMonth() + 1;
            var dd = date.getDate();
            var yyyy = date.getFullYear();
            if (mm < 10) { mm = '0' + mm }
            if (dd < 10) { dd = '0' + dd }
            date = mm + '/' + dd + '/' + yyyy;

            // Display flights.json data into a table

            $(document).ready(function() {
                $.getJSON("flights.json", function(data){
                    var status_data = '';
                    $.each(data, function(key, flights){
                        for(var i = 0; i < flights.length; i++){
                            if(flights[i].sourceAirport=="JFK" && flights[i].date == date){
                                status_data += '<tr>';
                                status_data += '<td>'+ flights[i].departureTime +'</td>';
                                status_data += '<td>'+ flights[i].destinationAirport +'</td>';
                                status_data += '<td>'+ flights[i].gate +'</td>';
                                if(flights[i].status === 'Boarding') {
                                    status_data += '<td class="status">' + flights[i].status + '</td>';
                                } else if(flights[i].status === 'On Time') {
                                    status_data += '<td class="status onTime">' + flights[i].status + '</td>';
                                } else if(flights[i].status === 'Delayed') {
                                    status_data += '<td class="status delayed">' + flights[i].status + '</td>';
                                } else {
                                    status_data += '<td class="status cancelled">' + flights[i].status + '</td>';
                                }
                              status_data += '</tr>';
                            }
                        }
                    });
                    $('#status-table').append(status_data);
                });
            });

        </script>
        <div class="flightStatus">
        <br/>
        <h1>JFK Departure Flights Status</h1>
        <br/>
        <table id="status-table" class="statusContainer">
            <thead>
                <tr>
                    <th>Departure Time</th>
                    <th>Destination</th>
                    <th>Gate</th>
                    <th>Status</th>
                </tr>
            </thead>
        </table>
        </div>
    </body>
</html>